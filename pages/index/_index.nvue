<template>
  <view class="content">
    <view class="title">uQRCodeäºŒç»´ç ç”Ÿæˆ</view>

    <view class="qrcode-box">
      <uqrcode ref="uqrcode" />
      <text class="text">nvue</text>
    </view>
    <input class="input" v-model="qrcodeTextRandom" placeholder="ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ç”Ÿæˆè‡ªå®šä¹‰äºŒç»´ç " />
    <button class="button" type="primary" @tap="make">ç”Ÿæˆéšæœºå†…å®¹äºŒç»´ç </button>
    <button class="button" type="primary" @tap="save">ä¿å­˜äºŒç»´ç </button>
  </view>
</template>

<script>
  export default {
    data() {
      return {
        qrcodeSize: 256,
        qrcodeTextRandom: '',
        qrcodeModules: []
      }
    },
    onReady() {
      this.make()
    },
    methods: {
      make() {
        this.qrcodeTextRandom = this.uuid()
        // view
        uni.showLoading({
          mask: true,
          title: 'ç”Ÿæˆä¸­...'
        })
        this.$refs
          .uqrcode
          .make({
            mode: 'view',
            size: this.qrcodeSize,
            text: this.qrcodeTextRandom
          })
        uni.hideLoading()
      },
      save() {
        uni.showToast({
          icon: 'none',
          title: 'nvueæš‚ä¸æ”¯æŒï¼Œåªèƒ½é€šè¿‡æˆªå›¾ä¿å­˜ğŸ˜…'
        })
      },
      uuid(len = 32, firstU = true, radix = null) {
        let chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');
        let uuid = [];
        radix = radix || chars.length;

        if (len) {
          // å¦‚æœæŒ‡å®šuuidé•¿åº¦,åªæ˜¯å–éšæœºçš„å­—ç¬¦,0|xä¸ºä½è¿ç®—,èƒ½å»æ‰xçš„å°æ•°ä½,è¿”å›æ•´æ•°ä½
          for (let i = 0; i < len; i++) uuid[i] = chars[0 | Math.random() * radix];
        } else {
          let r;
          // rfc4122æ ‡å‡†è¦æ±‚è¿”å›çš„uuidä¸­,æŸäº›ä½ä¸ºå›ºå®šçš„å­—ç¬¦
          uuid[8] = uuid[13] = uuid[18] = uuid[23] = '-';
          uuid[14] = '4';

          for (let i = 0; i < 36; i++) {
            if (!uuid[i]) {
              r = 0 | Math.random() * 16;
              uuid[i] = chars[(i == 19) ? (r & 0x3) | 0x8 : r];
            }
          }
        }

        // ç§»é™¤ç¬¬ä¸€ä¸ªå­—ç¬¦,å¹¶ç”¨uæ›¿ä»£,å› ä¸ºç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºæ•°å€¼æ—¶,è¯¥guuidä¸èƒ½ç”¨ä½œidæˆ–è€…class
        if (firstU) {
          uuid.shift();
          return 'u' + uuid.join('');
        } else {
          return uuid.join('');
        }
      }
    }
  }
</script>

<style>
  /* #ifndef APP-NVUE */
  page {
    background-color: #f0f0f0;
  }

  /* #endif */

  .content {
    /* #ifndef APP-NVUE */
    display: flex;
    /* #endif */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    margin-top: 44px;
  }

  .title {
    /* #ifndef APP-NVUE */
    display: flex;
    /* #endif */
    flex-direction: column;
    align-items: center;
    margin-top: 50rpx;
    font-size: 36rpx;
    color: #666666;
  }

  .qrcode-box,
  .image-box,
  .canvas-box {
    /* #ifndef APP-NVUE */
    display: flex;
    /* #endif */
    flex-direction: column;
    align-items: center;
    margin-top: 50rpx;
  }

  .text {
    /* #ifndef APP-NVUE */
    display: block;
    /* #endif */
    margin-top: 12rpx;
    font-size: 34rpx;
  }

  .image-box {
    width: 400rpx;
    margin-top: 50rpx;
  }

  .image {
    /* #ifndef APP-NVUE */
    display: block;
    /* #endif */
    width: 400rpx;
    height: 400rpx;
  }

  .input {
    width: 600rpx;
    height: 40px;
    margin: 50rpx 0;
    padding: 0 20rpx;
    border: 1px solid #b0b0b0;
    border-radius: 5px;
    background-color: #ffffff;
  }

  .button {
    width: 690rpx;
    margin: 10rpx;
  }

  .button:last-child {
    margin-bottom: 50rpx;
  }

  .component {
    margin-top: 30rpx;
    text-align: center;
  }

  .component-title {
    /* #ifndef APP-NVUE */
    display: inline-block;
    /* #endif */
    padding: 20rpx 40rpx;
    border-bottom: 2px solid #d8d8d8;
    font-size: 36rpx;
  }

  .component-buttons {
    margin-top: 30rpx;
  }
</style>
